# $Header: /cvs/stx/stx/libjava/examples/chat/Make.proto,v 1.2 2015-03-20 12:08:02 vrany Exp $
#
# automagically generated from the projectDefinition: stx_libjava_examples_chat.
#
# -------------- no need to change anything below ----------
#
# This makefile generates some standalone demo applications
#
#    make
#       generates chat
#

TOP=../../..
INCLUDE_TOP=$(TOP)/..

# set to a dummy file name (like FORCE=@@@FORCE-BUILD@@@) to force the build of prereq packages
FORCE=
.PHONY: $(FORCE)

PACKAGE=stx:libjava/examples/chat
SUBDIRS=
SUPPRESS_LOCAL_ABBREVS="yes"
NOAUTOLOAD=1
NOSUBAUTOLOAD=1

LOCALINCLUDES= -I$(INCLUDE_TOP)/stx/libbasic -I$(INCLUDE_TOP)/stx/libview2
LOCALDEFINES=
GLOBALDEFINES=
MAIN_DEFINES=-DIGNORE_IMAGE -DNO_DISPLAY

RCSSOURCES=Make.proto *.st
LINKSOURCES=Make.proto *.st

DELIVERBINARIES=

LIBNAME=libstx_libjava_examples_chat
STCLOCALOPT='-package=$(PACKAGE)' -I. -headerDir=. $(LOCALINCLUDES) $(STCLOCALOPTIMIZATIONS) $(STCWARNINGS) $(LOCALDEFINES) -headerDir=.  -varPrefix=$(LIBNAME)


# ********** OPTIONAL: MODIFY the next line ***
# additional C-libraries that should be pre-linked with the class-objects
LD_OBJ_LIBS=
LOCAL_SHARED_LIBS=


# ********** OPTIONAL: MODIFY the next line ***
# additional C targets or libraries should be added below
LOCAL_EXTRA_TARGETS=

OBJS= $(COMMON_OBJS) $(UNIX_OBJS)





LIBLIST = $(REQUIRED_LIBS)

# required libs:
#

REQUIRED_LIBS= libstx_libbasic \
 libstx_libbasic2 \
 libstx_libcomp \
 libstx_libbasic3 \
 libstx_libview \
 libstx_libui \
 libstx_libview2 \
 libstx_goodies_sunit \
 libstx_libwidg \
 libstx_libhtml \
 libstx_libwidg2 \
 libstx_libtool \
 libstx_libjava \


REQUIRED_LIBOBJS= ../../../libbasic/libstx_libbasic$(O_EXT) \
 ../../../libbasic2/libstx_libbasic2$(O_EXT) \
 ../../../libcomp/libstx_libcomp$(O_EXT) \
 ../../../libbasic3/libstx_libbasic3$(O_EXT) \
 ../../../libview/libstx_libview$(O_EXT) \
 ../../../libui/libstx_libui$(O_EXT) \
 ../../../libview2/libstx_libview2$(O_EXT) \
 ../../../goodies/sunit/libstx_goodies_sunit$(O_EXT) \
 ../../../libwidg/libstx_libwidg$(O_EXT) \
 ../../../libhtml/libstx_libhtml$(O_EXT) \
 ../../../libwidg2/libstx_libwidg2$(O_EXT) \
 ../../../libtool/libstx_libtool$(O_EXT) \
 ../..//libstx_libjava$(O_EXT) \


REQUIRED_LINK_LIBOBJS= libstx_libbasic$(O_EXT) \
 libstx_libbasic2$(O_EXT) \
 libstx_libcomp$(O_EXT) \
 libstx_libbasic3$(O_EXT) \
 libstx_libview$(O_EXT) \
 libstx_libui$(O_EXT) \
 libstx_libview2$(O_EXT) \
 libstx_goodies_sunit$(O_EXT) \
 libstx_libwidg$(O_EXT) \
 libstx_libhtml$(O_EXT) \
 libstx_libwidg2$(O_EXT) \
 libstx_libtool$(O_EXT) \
 libstx_libjava$(O_EXT) \


REQUIRED_SUPPORT_DIRS=RESOURCEFILES

SUBPROJECT_LIBS=


target: ALL

all::   prereq ALL_NP

# like ALL, but not prereqs
ALL_NP:: exe $(SUBPROJECT_LIBS) $(REQUIRED_SUPPORT_DIRS) $(SETUP_RULE)

exe:    chat 

chat: $(APP_DIRS_TO_MAKE) $(APP_LIBOBJS) $(REQUIRED_LIBOBJS) $(OBJS)
	$(MAKE) link_chat


link_chat:
	$(MAKE) GUI_APPLICATION \
		    TARGET=chat \
		    APPLICATION_CLASSES="$(COMMON_CLASSES) $(UNIX_CLASSES)" \
		    APPLICATION_OBJS="$(OBJS)" \
		    APPLICATION_LIBLIST="$(REQUIRED_LIBS)" \
		    APPLICATION_LIBOBJS="$(REQUIRED_LIBOBJS)" \
		    APPLICATION_LINK_LIBOBJS="$(REQUIRED_LINK_LIBOBJS)" \
		    STARTUP_CLASS="ChatStart" \
		    STARTUP_SELECTOR="start" \
		    MAIN_DEFINES="-DIGNORE_IMAGE -DNO_DISPLAY"

# build all mandatory prerequisite packages (containing superclasses) for this package
prereq:
	$(MAKE) FORCE=@@@FORCE-BUILD@@@ $(REQUIRED_LIBOBJS)

#
# a self installable delivery
#
# backward compatible fallback
setup::
	@if test -d autopackage; then \
	    makepackage; \
	else \
	    echo "Error: make setup not yet available in this unix"; \
	    exit 1; \
	fi

#
# for linux, this uses autopackage
#
setup_linux:
	@if test -d autopackage; then \
	    makepackage; \
	else \
	    echo "Error: missing autopackage directory"; \
	    exit 1; \
	fi

#
# for mac, a dmg is generated
#
setup_macosx:   "Chat_dmg"
	hdiutil create -fs HFSX -layout SPUD "Chat.dmg" -srcfolder "Chat_dmg" -format UDZO -volname "Chat" -quiet

"Chat_dmg":
	@-rm -rf "Chat_dmg"
	@-mkdir "Chat_dmg"
	@-mkdir "Chat_dmg/Chat.app"
	@-mkdir "Chat_dmg/Chat.app/Contents"
	@-mkdir "Chat_dmg/Chat.app/Contents/MacOS"
	cp "chat" "Chat_dmg/Chat.app/Contents/MacOS/Chat"
	@-mkdir Chat_dmg/Chat.app/Contents/MacOS/.
	-cp -r *.so "Chat_dmg/Chat.app/Contents/MacOS/."
	-cp -r symbols.stc "Chat_dmg/Chat.app/Contents/MacOS/."
	-cp -r *.stx "Chat_dmg/Chat.app/Contents/MacOS/."
	-cp -r *.rc "Chat_dmg/Chat.app/Contents/MacOS/."
	-cp -r resources "Chat_dmg/Chat.app/Contents/MacOS/."


SOURCEFILES: chat_SOURCES \
	stx_SOURCES




RESOURCEFILES: chat_RESOURCES chat_BITMAPS  \
	stx_RESOURCES stx_STYLES stx_BITMAPS


chat_RESOURCES: 
	mkdir -p resources/stx/libjava/examples/chat
	-cp ../resources/*.rs ../resources/*.style resources/stx/libjava/examples/chat/..

chat_BITMAPS: 
	mkdir -p resources/stx/libjava/examples/chat/bitmaps
	-cp *.ico *.gif *.png resources/stx/libjava/examples/chat/bitmaps



stx_RESOURCES: \
	keyboard.rc \
	keyboardMacros.rc \
	display.rc \
	libbasic_RESOURCES \
	libview_RESOURCES \
	libtool_RESOURCES  \
	libtool2_RESOURCES

keyboard.rc: $(TOP)/projects/smalltalk/keyboard.rc
	cp $(TOP)/projects/smalltalk/keyboard.rc .

keyboardMacros.rc: $(TOP)/projects/smalltalk/keyboardMacros.rc
	cp $(TOP)/projects/smalltalk/keyboardMacros.rc .

display.rc: $(TOP)/projects/smalltalk/display.rc
	cp $(TOP)/projects/smalltalk/display.rc .

stx_STYLES: 
	mkdir -p resources/stx/libview
	mkdir -p resources/stx/libview/styles
	cp $(TOP)/libview/styles/*.common resources/stx/libview/styles
	cp $(TOP)/libview/styles/*.style resources/stx/libview/styles

stx_BITMAPS: \
	libwidg_BITMAPS

libwidg_BITMAPS: 
	mkdir -p resources/stx/libwidg/bitmaps
	-cp $(TOP)/libwidg/bitmaps/*.* resources/stx/libwidg/bitmaps

libbasic_RESOURCES: 
	mkdir -p resources/stx/libbasic
	-cp $(TOP)/libbasic/resources/*.* resources/stx/libbasic

libtool_RESOURCES: 
	mkdir -p resources/stx/libtool
	-cp $(TOP)/libtool/resources/*.* resources/stx/libtool

libtool2_RESOURCES: 
	mkdir -p resources/stx/libtool2
	-cp $(TOP)/libtool2/resources/*.* resources/stx/libtool2

libview_RESOURCES: 
	mkdir -p resources/stx/libview
	-cp $(TOP)/libview/resources/*.* resources/stx/libview

libview2_RESOURCES: 
	mkdir -p resources/stx/libview2
	-cp $(TOP)/libview2/resources/*.* resources/stx/libview2

bitmaps:
	mkdir -p bitmaps

doc:
	mkdir -p doc



libstx_libbasic.so: ../../../libbasic/libstx_libbasic.so
	ln -sf ../../../libbasic/libstx_libbasic.so .

../../../libbasic/libstx_libbasic.so: ../../../libbasic/makefile $(FORCE)
	@if [ -f "../../../libbasic/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libbasic (no source)"; \
	else \
	    cd ../../../libbasic && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libbasic/makefile: ../../../libbasic/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libbasic

libstx_libbasic2.so: ../../../libbasic2/libstx_libbasic2.so
	ln -sf ../../../libbasic2/libstx_libbasic2.so .

../../../libbasic2/libstx_libbasic2.so: ../../../libbasic2/makefile $(FORCE)
	@if [ -f "../../../libbasic2/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libbasic2 (no source)"; \
	else \
	    cd ../../../libbasic2 && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libbasic2/makefile: ../../../libbasic2/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libbasic2

libstx_libcomp.so: ../../../libcomp/libstx_libcomp.so
	ln -sf ../../../libcomp/libstx_libcomp.so .

../../../libcomp/libstx_libcomp.so: ../../../libcomp/makefile $(FORCE)
	@if [ -f "../../../libcomp/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libcomp (no source)"; \
	else \
	    cd ../../../libcomp && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libcomp/makefile: ../../../libcomp/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libcomp

libstx_libbasic3.so: ../../../libbasic3/libstx_libbasic3.so
	ln -sf ../../../libbasic3/libstx_libbasic3.so .

../../../libbasic3/libstx_libbasic3.so: ../../../libbasic3/makefile $(FORCE)
	@if [ -f "../../../libbasic3/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libbasic3 (no source)"; \
	else \
	    cd ../../../libbasic3 && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libbasic3/makefile: ../../../libbasic3/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libbasic3

libstx_libview.so: ../../../libview/libstx_libview.so
	ln -sf ../../../libview/libstx_libview.so .

../../../libview/libstx_libview.so: ../../../libview/makefile $(FORCE)
	@if [ -f "../../../libview/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libview (no source)"; \
	else \
	    cd ../../../libview && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libview/makefile: ../../../libview/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libview

libstx_libui.so: ../../../libui/libstx_libui.so
	ln -sf ../../../libui/libstx_libui.so .

../../../libui/libstx_libui.so: ../../../libui/makefile $(FORCE)
	@if [ -f "../../../libui/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libui (no source)"; \
	else \
	    cd ../../../libui && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libui/makefile: ../../../libui/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libui

libstx_libview2.so: ../../../libview2/libstx_libview2.so
	ln -sf ../../../libview2/libstx_libview2.so .

../../../libview2/libstx_libview2.so: ../../../libview2/makefile $(FORCE)
	@if [ -f "../../../libview2/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libview2 (no source)"; \
	else \
	    cd ../../../libview2 && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libview2/makefile: ../../../libview2/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libview2

libstx_goodies_sunit.so: ../../../goodies/sunit/libstx_goodies_sunit.so
	ln -sf ../../../goodies/sunit/libstx_goodies_sunit.so .

../../../goodies/sunit/libstx_goodies_sunit.so: ../../../goodies/sunit/makefile $(FORCE)
	@if [ -f "../../../goodies/sunit/.NOSOURCE" ]; then \
	    echo "skip make in ../../../goodies/sunit (no source)"; \
	else \
	    cd ../../../goodies/sunit && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../goodies/sunit/makefile: ../../../goodies/sunit/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../goodies/sunit

libstx_libwidg.so: ../../../libwidg/libstx_libwidg.so
	ln -sf ../../../libwidg/libstx_libwidg.so .

../../../libwidg/libstx_libwidg.so: ../../../libwidg/makefile $(FORCE)
	@if [ -f "../../../libwidg/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libwidg (no source)"; \
	else \
	    cd ../../../libwidg && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libwidg/makefile: ../../../libwidg/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libwidg

libstx_libhtml.so: ../../../libhtml/libstx_libhtml.so
	ln -sf ../../../libhtml/libstx_libhtml.so .

../../../libhtml/libstx_libhtml.so: ../../../libhtml/makefile $(FORCE)
	@if [ -f "../../../libhtml/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libhtml (no source)"; \
	else \
	    cd ../../../libhtml && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libhtml/makefile: ../../../libhtml/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libhtml

libstx_libwidg2.so: ../../../libwidg2/libstx_libwidg2.so
	ln -sf ../../../libwidg2/libstx_libwidg2.so .

../../../libwidg2/libstx_libwidg2.so: ../../../libwidg2/makefile $(FORCE)
	@if [ -f "../../../libwidg2/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libwidg2 (no source)"; \
	else \
	    cd ../../../libwidg2 && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libwidg2/makefile: ../../../libwidg2/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libwidg2

libstx_libtool.so: ../../../libtool/libstx_libtool.so
	ln -sf ../../../libtool/libstx_libtool.so .

../../../libtool/libstx_libtool.so: ../../../libtool/makefile $(FORCE)
	@if [ -f "../../../libtool/.NOSOURCE" ]; then \
	    echo "skip make in ../../../libtool (no source)"; \
	else \
	    cd ../../../libtool && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../../../libtool/makefile: ../../../libtool/Make.proto
	$(TOP)/rules/stmkmf --cd ../../../libtool

libstx_libjava.so: ../..//libstx_libjava.so
	ln -sf ../..//libstx_libjava.so .

../..//libstx_libjava.so: ../..//makefile $(FORCE)
	@if [ -f "../..//.NOSOURCE" ]; then \
	    echo "skip make in ../../ (no source)"; \
	else \
	    cd ../../ && $(MAKE) "CFLAGS_LOCAL=$(GLOBALDEFINES) "; \
	fi

../..//makefile: ../..//Make.proto
	$(TOP)/rules/stmkmf --cd ../../





java: ant

ant:
	ant -f java/build.xml

antIfPossible:
	-ant -f java/build.xml

full::  ant

zlib:
	cd $(ZLIB_DIR); $(MAKE) $(MAKE_ZLIB_ARG)

support/fdlibm/libfdm.a:
	$(MAKE) CCCONFOPT="$(CCCONFOPT)" -C support/fdlibm






# Enforce recompilation of package definition class if Mercurial working
# copy state changes. Together with --guessVersion it ensures that package
# definition class always contains correct binary revision string.
ifneq (**NOHG**, $(shell hg root 2> /dev/null || echo -n '**NOHG**'))
stx_libjava_examples_chat.$(O): $(shell hg root)/.hg/dirstate
endif




clean::
	-rm -f *.so chat.$(O)

clobber:: clean
	-rm -f chat *.img *.sav

# BEGINMAKEDEPEND --- do not remove this line; make depend needs it
$(OUTDIR)Chat.$(O) Chat.$(H): Chat.st $(INCLUDE_TOP)/stx/libview2/ApplicationModel.$(H) $(INCLUDE_TOP)/stx/libview2/Model.$(H) $(INCLUDE_TOP)/stx/libbasic/Object.$(H) $(STCHDR)
$(OUTDIR)ChatStart.$(O) ChatStart.$(H): ChatStart.st $(INCLUDE_TOP)/stx/libbasic/StandaloneStartup.$(H) $(INCLUDE_TOP)/stx/libbasic/Object.$(H) $(STCHDR)
$(OUTDIR)ChatWindow.$(O) ChatWindow.$(H): ChatWindow.st $(INCLUDE_TOP)/stx/libview2/ApplicationModel.$(H) $(INCLUDE_TOP)/stx/libview2/Model.$(H) $(INCLUDE_TOP)/stx/libbasic/Object.$(H) $(STCHDR)
$(OUTDIR)stx_libjava_examples_chat.$(O) stx_libjava_examples_chat.$(H): stx_libjava_examples_chat.st $(INCLUDE_TOP)/stx/libbasic/ApplicationDefinition.$(H) $(INCLUDE_TOP)/stx/libbasic/ProjectDefinition.$(H) $(INCLUDE_TOP)/stx/libbasic/Object.$(H) $(STCHDR)

# ENDMAKEDEPEND --- do not remove this line

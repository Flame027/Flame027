#
# $Header: /cvs/stx/stx/rules/vmsmake.ini,v 1.5 2005-07-08 21:05:12 cg Exp $
#
# before making,
# this file is to be copied to each dir where st-libs are created, 
# named as make.ini
#

TOP=stx

LIBDIR=[stx.lib]
BINDIR=[stx.bin]
INCDIR=[stx.include]

COMMONSYMBOLS=
SEPINITCODE=
STCFLAGS1=-I$(INCDIR) -headerDir=$(INCDIR)
STCFLAGS2=$(COMMONSYMBOLS) $(SEPINITCODE)

O=obj

CC=cc
STC=stc
MAKE=make /input=vms.mak

# DEFINES=/defines=("__openVMS__", "alpha64")
DEFINES=/defines=("__openVMS__","alpha","VGL")
WARNINGS=/nowarnings
INCLUDES=/include=$(INCDIR)
# CCOPT=/nooptimize
CCOPT=
CFLAGS1=/standard=common /assume=nowritable_string_literals/names=as_is
CFLAGS=$(CCOPT) $(CFLAGS1) $(DEFINES) $(INCLUDES) $(WARNINGS)

#
# thats to be overriden by the local vms.mak
#
OBJS=
PACKAGE=
#STCLOCALOPT=
#LIBNAME=

all:	make.ini theLib theProgram

*.c : *.st
	write sys$output "compiling $*.st ..."
	stc := $STX$ROOT:[bin]stc.exe
	stc -ccode $(STCFLAGS1) $(PACKAGE) $(STCLOCALOPT) $(STCFLAGS2) $*.st

*.obj : *.st
	$(MAKE) $*.c
	write sys$output "compiling $*.c ..."
	$(CC) $(CFLAGS) $*.c
	del $*.c;*
	write sys$output "replace $*.obj in classLibrary $(LIBNAME).olb ..."
	lib/replace $(LIBNAME).olb $*.obj

*.obj : *.c
	write sys$output "compiling $*.c ..."
	$(CC) $(CFLAGS) $*.c
	write sys$output "replace $*.obj in classLibrary $(LIBNAME).olb ..."
	lib/replace $(LIBNAME).olb $*.obj

purge:
	purge
	del aaa*.*;*

clean:
	purge
	del aaa*.*;*
	del *.obj;*
	del vmsLibInit.c;*

clobber: clean
	del *.olb;*

make.ini: [$(TOP).rules]vmsmake.ini
	write sys$output "updating make.ini from vmsmake.ini ..."
	cop [$(TOP).rules]vmsmake.ini make.ini
	$(MAKE)

libinit: libInit.cc
	write sys$output "compiling libInit from libInit.cc ..."
	copy libInit.cc libInit.c
	$(CC) $(CFLAGS) libInit.c
	del libInit.c;*
	lib/replace $(LIBNAME).olb libInit.$(O)
	purge libInit.$(O)
	purge $(LIBNAME).olb
